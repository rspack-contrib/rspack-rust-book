<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Release - Rspack Rust Book</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../res/mermaid-anti-flash.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rspack Rust Book</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rspack-contrib/rspack-rust-book/tree/main" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/rspack-contrib/rspack-rust-book/tree/main/src/custom-binding/first-custom-binding/release.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="release"><a class="header" href="#release">Release</a></h1>
<p>This chapter covers releasing your plugin to npm using GitHub Actions. The template includes a complete <a href="https://github.com/rspack-contrib/rspack-binding-template/blob/main/.github/workflows/release.yml">release workflow</a> that automatically handles building, testing, and publishing.</p>
<h2 id="release-workflow"><a class="header" href="#release-workflow">Release Workflow</a></h2>
<h3 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h3>
<p>Before releasing, ensure you have completed these requirements:</p>
<h4 id="1-update-repository-information"><a class="header" href="#1-update-repository-information">1. Update Repository Information</a></h4>
<p>You <strong>must</strong> update the repository URLs in your <code>package.json</code> files to match your actual repository, otherwise you'll encounter a Sigstore provenance verification error during publishing:</p>
<pre><code class="language-text">npm error 422 Unprocessable Entity - PUT https://registry.npmjs.org/@your-scope%2fyour-package-darwin-x64
Error verifying sigstore provenance bundle: Failed to validate repository information:
package.json: "repository.url" is "git+https://github.com/rspack-contrib/rspack-binding-template.git",
expected to match "https://github.com/your-username/your-repository" from provenance
</code></pre>
<p>Update the following files:</p>
<ul>
<li><code>package.json</code> - Update the <code>repository.url</code>, <code>bugs.url</code>, and <code>homepage</code> fields</li>
<li><code>crates/binding/package.json</code> - Update the <code>repository.url</code>, <code>bugs.url</code>, and <code>homepage</code> fields</li>
</ul>
<p>For example, change:</p>
<pre><code class="language-json">{
  "repository": {
    "type": "git",
    "url": "git+https://github.com/rspack-contrib/rspack-binding-template.git"
  },
  "bugs": {
    "url": "https://github.com/rspack-contrib/rspack-binding-template/issues"
  },
  "homepage": "https://github.com/rspack-contrib/rspack-binding-template#readme"
}
</code></pre>
<p>To:</p>
<pre><code class="language-json">{
  "repository": {
    "type": "git",
    "url": "git+https://github.com/your-username/your-repository.git"
  },
  "bugs": {
    "url": "https://github.com/your-username/your-repository/issues"
  },
  "homepage": "https://github.com/your-username/your-repository#readme"
}
</code></pre>
<h4 id="2-configure-npm-token"><a class="header" href="#2-configure-npm-token">2. Configure NPM Token</a></h4>
<p>The release workflow requires an <a href="https://docs.github.com/en/actions/how-tos/writing-workflows/choosing-what-your-workflow-does/using-secrets-in-github-actions#creating-secrets-for-an-environment"><em>Environment secret</em></a> with <code>NPM_TOKEN</code> to be set in the repository settings:</p>
<ol>
<li>
<p>On GitHub, navigate to the main page of the repository.</p>
</li>
<li>
<p>Under your repository name, click Settings. If you cannot see the "Settings" tab, select the dropdown menu, then click Settings.</p>
</li>
</ol>
<img src="../../images/repository-settings-button.png" alt="Repository settings button" height="100" />
<ol start="3">
<li>
<p>In the left sidebar, click Environments.</p>
</li>
<li>
<p>Click "New environment" to add a new environment.</p>
</li>
</ol>
<img src="../../images/repository-settings-environments.png" alt="Repository settings environments" height="250" />
<ol start="5">
<li>
<p>Type <code>npm</code> as the name for the environment.</p>
</li>
<li>
<p>Click "Add environment secret".</p>
</li>
<li>
<p>Enter the name for your secret as "NPM_TOKEN".</p>
</li>
<li>
<p>Enter the value for your secret.</p>
<blockquote>
<p><strong>Note:</strong> If you don't have a token, you can follow this guide to <a href="https://docs.npmjs.com/creating-and-viewing-access-tokens/">create a new token</a>.</p>
<p>If you're using "Granular Access Token", make sure to select the "Read and write" scope and select "Only select packages and scopes" and select the scope for the package you want to publish (e.g. <code>@rspack-template</code>).</p>
</blockquote>
</li>
<li>
<p>Click Add secret.</p>
</li>
</ol>
<img src="../../images/repository-settings-environments-secrets.png" alt="Repository settings environments secrets" height="300" />
<h3 id="1-create-a-release-branch"><a class="header" href="#1-create-a-release-branch">1. Create a Release Branch</a></h3>
<p>To release a new version, create a new branch. You can use any branch name, but it's recommended to use a name indicating the version you're releasing.</p>
<p>For example, if you're releasing version <code>0.0.1</code>, create a branch named <code>release-v0.0.1</code>.</p>
<pre><code class="language-bash">git checkout -b release-v0.0.1
</code></pre>
<h3 id="2-trigger-a-version-bump"><a class="header" href="#2-trigger-a-version-bump">2. Trigger a Version Bump</a></h3>
<p>Before releasing, bump the versions in both <code>package.json</code> and <code>crates/binding/package.json</code>.</p>
<p>rspack-binding-template doesn't include any version bump tool. You can either manually bump the versions in both <code>package.json</code> files or set up any version bump tool.</p>
<p>For example: <a href="https://github.com/h-a-n-a/my-rspack-binding/pull/1">PR: chore: release v0.0.1</a></p>
<h3 id="3-trigger-the-release-workflow"><a class="header" href="#3-trigger-the-release-workflow">3. Trigger the Release Workflow</a></h3>
<ol>
<li>Navigate to <strong>Actions</strong> → <strong>Release</strong> in your repository</li>
<li>Click <strong>Run workflow</strong></li>
<li>Configure options:
<ul>
<li><strong>Use workflow from</strong>: Select the branch to release from (in this case, <code>release-v0.0.1</code>)</li>
<li><strong>Dry-run mode</strong>: Test without publishing</li>
<li><strong>NPM tag</strong>: Choose <code>latest</code>, <code>alpha</code>, <code>beta</code>, or <code>canary</code></li>
</ul>
</li>
<li>Click the <strong>Run workflow</strong> button in the popover</li>
</ol>
<img src="../../images/repository-actions-release.png" alt="Release workflow selection" height="500" />
<p>The workflow will trigger and you can monitor progress in the <strong>Actions</strong> tab.</p>
<p>For example: <a href="https://github.com/h-a-n-a/my-rspack-binding/actions/runs/16519440059">Release v0.0.1</a></p>
<img src="../../images/repository-actions-release-workflow.png" alt="Release workflow run" height="500" />
<h2 id="workflow-deep-dive"><a class="header" href="#workflow-deep-dive">Workflow Deep Dive</a></h2>
<p>The workflow consists of three sequential jobs:</p>
<h3 id="1-build"><a class="header" href="#1-build">1. Build</a></h3>
<p>Compiles the Node.js addon for all supported targets using the <a href="https://github.com/rspack-contrib/rspack-toolchain/blob/main/.github/workflows/build.yml">rspack-toolchain build workflow</a>. The build uses the release profile for optimal performance:</p>
<pre><code class="language-toml">[profile.release]
codegen-units = 1
debug = false
lto = "fat"
opt-level = 3
panic = "abort"
strip = true
</code></pre>
<h3 id="2-test"><a class="header" href="#2-test">2. Test</a></h3>
<p>Validates the built bindings using the test suite to ensure everything works correctly before publishing.</p>
<h3 id="3-release"><a class="header" href="#3-release">3. Release</a></h3>
<p>Publishes the packages to the npm registry:</p>
<ol>
<li><strong>Environment Setup</strong>: Configures Node.js 22, pnpm, and dependency caching</li>
<li><strong>Artifact Processing</strong>: Downloads compiled bindings and organizes them into platform-specific npm packages using <code>pnpm napi create-npm-dirs</code> and <code>pnpm napi artifacts</code></li>
<li><strong>Package Preparation</strong>: Configures npm authentication and runs <code>pnpm napi pre-publish</code> to prepare platform packages</li>
<li><strong>Publishing</strong>: Uses <code>pnpm publish -r</code> to publish all packages with the specified tag</li>
</ol>
<h2 id="package-provenance"><a class="header" href="#package-provenance">Package Provenance</a></h2>
<p>All packages published through this workflow include <a href="https://docs.npmjs.com/generating-provenance-statements#about-npm-provenance">npm provenance</a> statements, enhancing supply-chain security by:</p>
<ul>
<li><strong>Provenance attestation</strong>: Publicly links packages to their source code and build instructions, allowing developers to verify where and how packages were built</li>
<li><strong>Publish attestation</strong>: Generated by the npm registry when packages are published by authorized users</li>
</ul>
<p>The workflow automatically enables provenance using the <code>--provenance</code> flag. Packages are signed by <a href="https://docs.npmjs.com/generating-provenance-statements#about-sigstore">Sigstore</a> public servers and logged in a public transparency ledger, providing verifiable proof of the package's origin and build process.</p>
<h2 id="supported-targets"><a class="header" href="#supported-targets">Supported Targets</a></h2>
<p>The workflow builds for these targets:</p>
<pre><code class="language-text">x86_64-apple-darwin
x86_64-pc-windows-msvc
x86_64-unknown-linux-gnu
x86_64-unknown-linux-musl
i686-pc-windows-msvc
aarch64-unknown-linux-gnu
aarch64-apple-darwin
aarch64-unknown-linux-musl
aarch64-pc-windows-msvc
armv7-linux-androideabi
armv7-unknown-linux-gnueabihf
aarch64-linux-android
</code></pre>
<p>For the complete list, see <a href="https://github.com/rspack-contrib/rspack-toolchain?tab=readme-ov-file#supported-targets">rspack-toolchain supported targets</a>.</p>
<h2 id="manual-release"><a class="header" href="#manual-release">Manual Release</a></h2>
<p>To trigger a release:</p>
<ol>
<li>Navigate to <strong>Actions</strong> → <strong>Release</strong> in your repository</li>
<li>Click <strong>Run workflow</strong></li>
<li>Configure options:
<ul>
<li><strong>Dry-run mode</strong>: Test without publishing (recommended first)</li>
<li><strong>NPM tag</strong>: Choose <code>latest</code>, <code>alpha</code>, <code>beta</code>, or <code>canary</code></li>
</ul>
</li>
</ol>
<p>The workflow will automatically build, test, and publish your plugin packages to npm, making them available for installation.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../custom-binding/first-custom-binding/create-plugin.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../custom-binding/create-a-loader.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../custom-binding/first-custom-binding/create-plugin.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../custom-binding/create-a-loader.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../res/mermaid-anti-flash.js"></script>
        <script src="../../res/mermaid.min.js"></script>
        <script src="../../res/mermaid-init.js"></script>



    </div>
    </body>
</html>
